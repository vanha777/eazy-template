# Use the official Rust image as a base
FROM messense/rust-musl-cross:x86_64-musl as builder

# Environments
ENV PORT=3070

# Set the working directory
WORKDIR /usr/src/eazy-template

# Copy the application code
COPY . .

# Make the setup script executable and run it
RUN chmod +x ./services/service_docurust/setup.sh && ./services/service_docurust/setup.sh

# # Copy the setup script from the service directory to the workspace root
# COPY services/service_docurust/setup.sh ./setup.sh

# # Make the setup script executable and run it
# RUN chmod +x setup.sh && ./setup.sh

# Final stage/image
FROM scratch

# # Install wkhtmltopdf
# RUN apt-get install -y wkhtmltopdf

# Copy the built binary from the builder stage
COPY --from=builder /usr/src/eazy-template/target/release/service_docurust /service_docurust

# Copy CA certificates from the builder stage
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ca-certificates.crt

# # Copy wkhtmltopdf and its dependencies
# COPY --from=builder /usr/local/bin/wkhtmltopdf /usr/local/bin/

# Set the entry point for the container
ENTRYPOINT ["/service_docurust"]

# Expose the port the server is running on
EXPOSE 3070

